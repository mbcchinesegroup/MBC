 <!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>201-300名句配對消消樂遊戲</title>
 <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: "Microsoft JhengHei", Arial, sans-serif;
      background: linear-gradient(135deg, #f4f8fb 0%, #e0eaf8 100%);
      margin: 0;
      padding: 20px 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      color: #333;
    }
 
    .container {
      width: 95%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .header {
      text-align: center;
      margin-bottom: 15px;
      width: 100%;
    }
   
      /* 半透明背景Logo */
    .logo-background {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.2; /* 半透明效果 */
      z-index: -1;
      pointer-events: none;
      max-width: 80%;
      max-height: 80%;
    }
    
    .logo-background img {
      width: 300px;
      height: 300px;
      object-fit: contain;
    }

   h1 { 
      margin: 10px 0 5px; 
      color: #1976d2;
      text-align: center;
      font-size: 1.8rem;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }
    
    .topbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 10px 0;
      font-size: 14px;
      width: 100%;
    }
    
    .stat {
      background: #fff;
      border-radius: 8px;
      padding: 8px 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      min-width: 90px;
      text-align: center;
      border-left: 4px solid #1976d2;
      font-size: 14px;
    }
    
    #status { 
      margin: 10px 0; 
      font-size: 16px; 
      font-weight: bold;
      color: #2c3e50;
      text-align: center;
      padding: 10px 16px;
      background: rgba(255,255,255,0.8);
      border-radius: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .game-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 10px 0;
    }
    
    #game-board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      max-width: 1000px;
      width: 100%;
      margin: 15px auto;
      position: relative;
    }
    
    .card {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: #fff;
      border-radius: 10px;
      height: 110px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      user-select: none;
      padding: 10px;
      text-align: center;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    
    .card:active { 
      transform: scale(0.98); 
    }
    
    .card.flipped {
      background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
      color: #222;
      cursor: default;
    }
    
    .card.matched {
      animation: matchedAnimation 0.6s forwards;
      cursor: default;
    }
    
    @keyframes matchedAnimation {
      0% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.7;
      }
      100% {
        transform: scale(0);
        opacity: 0;
        visibility: hidden;
      }
    }
    
    .card.mismatched {
      background: linear-gradient(135deg, #ffcdd2 0%, #ef9a9a 100%);
      color: #c62828;
    }
    
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      backface-visibility: hidden;
      transition: transform 0.6s;
      border-radius: 8px;
      padding: 10px;
      box-sizing: border-box;
    }
    
    .card-front {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: white;
      font-weight: bold;
      font-size: 16px;
    }
    
    .card-back {
      background: white;
      color: #222;
      transform: rotateY(180deg);
      justify-content: center;
      font-size: 14px;
      overflow: auto;
      text-overflow: ellipsis;
    }
    
    .card.flipped .card-front {
      transform: rotateY(180deg);
    }
    
    .card.flipped .card-back {
      transform: rotateY(0deg);
    }
    
    button {
      margin: 8px 5px;
      padding: 10px 16px;
      font-size: 14px;
      border: none;
      background: #1976d2;
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    
    button:hover {
      background: #1565c0;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    
    button:active { 
      transform: translateY(1px); 
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    
    .controls {
      display: flex; 
      gap: 10px; 
      flex-wrap: wrap; 
      justify-content: center;
      margin: 10px 0;
      width: 100%;
    }
    
    .settings {
      display: flex;
      gap: 10px;
      margin: 15px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .setting-item {
      display: flex;
      align-items: center;
      gap: 6px;
      background: white;
      padding: 8px 12px;
      border-radius: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      font-size: 14px;
    }
    
    select {
      padding: 5px;
      border-radius: 5px;
      border: 1px solid #ddd;
    }
    
    .note { 
      font-size: 13px; 
      color: #555; 
      margin: 5px 0 15px; 
      text-align: center;
      max-width: 600px;
      padding: 0 15px;
      line-height: 1.5;
    }
    
    .completed-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.98);
      padding: 25px 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      text-align: center;
      z-index: 100;
      animation: popIn 0.5s ease;
      width: 85%;
      max-width: 350px;
      border: 2px solid #1976d2;
    }
    
    .completed-message h2 {
      color: #1976d2;
      margin-bottom: 15px;
    }
    
    .completed-message p {
      margin: 10px 0;
      font-size: 16px;
    }
    
    /* 答案欄樣式 */
    #answer-board {
      width: 100%;
      max-width: 1000px;
      margin: 20px 0;
      padding: 15px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    #answer-board h2 {
      text-align: center;
      color: #1976d2;
      margin: 0 0 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #1976d2;
      font-size: 1.4rem;
    }
    
    .answer-pair {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px dashed #ccc;
      padding-bottom: 15px;
      align-items: center;
      min-height: 75px;
    }
    
    .answer-pair:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .pair-number {
      width: 28px;
      height: 28px;
      background: #1976d2;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 10px;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.5s ease;
      font-size: 13px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .pair-number.visible {
      opacity: 1;
    }
    
    .answer-text, .answer-source {
      flex: 1;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
      margin: 0 5px;
      min-height: 55px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
      position: relative;
      font-size: 14px;
    }
    
    .answer-text {
      border-left: 4px solid #4caf50;
    }
    
    .answer-source {
      border-left: 4px solid #2196f3;
    }
    
    .answer-type {
      position: absolute;
      top: 4px;
      left: 8px;
      font-size: 11px;
      color: #888;
    }
    
    .answer-placeholder {
      color: #999;
      font-style: italic;
      font-size: 13px;
    }
    
    @keyframes popIn {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 99;
    }
    
    /* 手機版專用樣式 */
    .mobile-controls {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px;
      box-shadow: 0 -3px 12px rgba(0,0,0,0.1);
      z-index: 10;
      justify-content: space-around;
    }
    
    .mobile-btn {
      padding: 12px 16px;
      font-size: 14px;
      border: none;
      background: #1976d2;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    /* 響應式設計 */
    @media (max-width: 1000px) {
      #game-board { grid-template-columns: repeat(4, 1fr); }
    }
    
    @media (max-width: 800px) {
      #game-board { grid-template-columns: repeat(3, 1fr); }
      .card { height: 100px; font-size: 13px; }
      .answer-pair { flex-direction: column; }
      .answer-text, .answer-source { margin: 5px 0; width: 100%; }
      .pair-number { margin: 0 0 8px 0; }
    }
    
    @media (max-width: 600px) {
      h1 { font-size: 1.5rem; margin: 8px 0 4px; }
      .topbar { gap: 8px; }
      .stat { 
        min-width: 80px; 
        font-size: 13px; 
        padding: 7px 10px;
      }
      #status { font-size: 14px; padding: 8px 14px; }
      #game-board { 
        grid-template-columns: repeat(2, 1fr); 
        gap: 10px;
      }
      .card { 
        height: 90px; 
        font-size: 13px; 
        border-radius: 8px;
      }
      .card-back { font-size: 12px; }
      .controls { gap: 8px; }
      button { 
        padding: 9px 14px; 
        font-size: 13px;
      }
      .setting-item { font-size: 13px; }
      .note { font-size: 12px; }
      
      /* 顯示手機底部控制欄 */
      .mobile-controls {
        display: flex;
      }
      
      /* 隱藏桌面版控制按鈕 */
      .controls {
        display: none;
      }
      
      /* 調整答案欄樣式 */
      #answer-board {
        margin-bottom: 80px;
        padding: 12px;
      }
      #answer-board h2 { font-size: 1.3rem; }
      .answer-text, .answer-source { 
        font-size: 13px; 
        padding: 8px;
      }
    }
    
    @media (max-width: 400px) {
      #game-board { grid-template-columns: repeat(2, 1fr); }
      .card { 
        height: 85px; 
        font-size: 12px; 
        padding: 8px;
      }
      .card-back { font-size: 11px; }
      .card-front { font-size: 14px; }
      .stat { min-width: 70px; font-size: 12px; }
      h1 { font-size: 1.4rem; }
      .mobile-btn { padding: 11px 14px; font-size: 13px; }
    }
    
    @media (max-width: 350px) {
      .card { height: 80px; }
      #game-board { gap: 8px; }
    }

    /* 防止手機上文字選中 */
    .no-select {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    /* 遊戲難度標籤 */
    .difficulty-tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 5px;
      background: #e3f2fd;
      color: #1976d2;
    }
  </style>
</head>
<body class="no-select">
 
  <div class="container">
    <div class="header">
      <h1>中文組</h1>
      <h1>201-300名句配對消消樂</h1>
    </div>
    
    <div class="topbar">
      <div class="stat">計時：<span id="timer">00:00.0</span></div>
      <div class="stat">配對：<span id="pairs">0</span>/<span id="total-pairs">0</span></div>
      <div class="stat">最佳：<span id="best">—</span></div>
    </div>

    <div id="status">請翻開兩張卡牌進行配對</div>

    <div class="settings">
      <div class="setting-item">
        <label for="pair-count">遊戲難度:</label>
        <select id="pair-count">
          <option value="5">簡單 <span class="difficulty-tag">5組</span></option>
          <option value="8">中等 <span class="difficulty-tag">8組</span></option>
          <option value="10">困難 <span class="difficulty-tag">10組</span></option>
        </select>
      </div>
    </div>

    <div class="controls">
      <button id="btn-home" class="btn">主頁</button>
      <button id="btn-new" class="btn">重新開始</button>
      <button id="btn-pause" class="btn">暫停</button>
      <button id="btn-resume" class="btn" style="display:none;">繼續</button>
    </div>
    
    <div class="note">提示：翻牌開始即計時，全部配對完成自動停止。配對成功時卡片會移動到下方答案欄。</div>

    <div class="game-container">
      <div id="game-board"></div>
    </div>
    
    <!-- 答案欄 -->
    <div id="answer-board">
      <h2>答案欄</h2>
      <div id="answer-container"></div>
    </div>
  </div>
  
  <!-- 手機版底部控制欄 -->
  <div class="mobile-controls">
    <button id="mobile-home" class="mobile-btn">主頁</button>
    <button id="mobile-new" class="mobile-btn">重新開始</button>
    <button id="mobile-pause" class="mobile-btn">暫停</button>
    <button id="mobile-resume" class="mobile-btn" style="display:none;">繼續</button>
  </div>
  
  <script>
    // 完整的名句列表（帶有序號）
    const quotes = [
{"id": 201, "text": "黃沙百戰穿金甲，不破樓蘭終不還。", "source": "王昌齡《從軍行》"},
{ "id": 202, "text": "欲窮千里目，更上一層樓。", "source": "王之煥《登鸛雀樓》" },
{ "id": 203, "text": "莫愁前路無知己，天下誰人不識君。", "source": "高適《別董大》" },
{ "id": 204, "text": "忽如一夜春風來，千樹萬樹梨花開。", "source": "岑參《白雪歌送武判官歸京》" },
{ "id": 205, "text": "近鄉情更怯，不敢問來人。", "source": "宋之問《渡漢江》" },
{ "id": 206, "text": "少小離家老大回，鄉音無改鬢毛衰。", "source": "賀知章《回鄉偶書》" },
{ "id": 207, "text": "兒童相見不相識，笑問客從何處來。", "source": "賀知章《回鄉偶書》" },
{ "id": 208, "text": "不知細葉誰裁出，二月春風似剪刀。", "source": "賀知章《咏柳》" },
{ "id": 209, "text": "晴川歷歷漢陽樹，芳草萋萋鸚鵡洲。", "source": "崔顥《黃鶴樓》" },
{ "id": 210, "text": "報國行赴難，古來皆共然。", "source": "崔顥《贈王威古》" },
{ "id": 211, "text": "桃花潭水深千尺，不及汪倫送我情。", "source": "李白《贈汪倫》" },
{ "id": 212, "text": "安能摧眉折腰事權貴，使我不得開心顏！", "source": "李白《夢游天姥吟留別》" },
{ "id": 213, "text": "不知明鏡裡，何處得秋霜。", "source": "李白《秋浦歌》" },
{ "id": 214, "text": "但使主人能醉客，不知何處是他鄉。", "source": "李白《客中作》" },
{ "id": 215, "text": "浮雲游子意，落日故人情。", "source": "李白《送友人》" },
{ "id": 216, "text": "君不見黃河之水天上來，奔流到海不復回。", "source": "李白《將進酒》" },
{ "id": 217, "text": "天生我材必有用，千金散盡還復來。", "source": "李白《將進酒》" },
{ "id": 218, "text": "俱懷逸興壯思飛，欲上青天攬（覽）明月。", "source": "李白《宣州謝朓樓餞別校書叔雲》" },
{ "id": 219, "text": "抽刀斷水水更流，舉杯消愁愁更愁。", "source": "李白《宣州謝朓樓餞別校書叔雲》" },
{ "id": 220, "text": "燕山雪花大如席，片片吹落軒轅台。", "source": "李白《北風行》" },
{ "id": 221, "text": "大鵬一日同風起，扶搖直上九萬里。", "source": "李白《上李邕》" },
{ "id": 222, "text": "舉杯邀明月，對影成三人。", "source": "李白《月下獨酌》" },
{ "id": 223, "text": "仰天大笑出門去，我輩豈是蓬蒿人。", "source": "李白《南陵別兒童入京》" },
{ "id": 224, "text": "清水出芙蓉，天然去雕飾。", "source": "李白《經亂離後天恩流夜郎憶舊遊書懷贈江夏韋太守良宰》" },
{ "id": 225, "text": "孤帆遠影碧空盡，惟見長江天際流。", "source": "李白《送孟浩然之廣陵》" },
{ "id": 226, "text": "長風破浪會有時，直掛雲帆濟滄海。", "source": "李白《行路難》" },
{ "id": 227, "text": "劍閣崢嶸而崔嵬，一夫當關，萬夫莫開。", "source": "李白《蜀道難》" },
{ "id": 228, "text": "射人先射馬，擒賊先擒王。", "source": "杜甫《前出塞》" },
{ "id": 229, "text": "爾曹身與名俱滅，不廢江河萬古流。", "source": "杜甫《戲為六絕句》" },
{ "id": 230, "text": "會當凌絕頂，一覽眾山小。", "source": "杜甫《望岳》" },
{ "id": 231, "text": "好雨知時節，當春乃發生。", "source": "杜甫《春夜喜雨》" },
{ "id": 232, "text": "細雨魚兒出，微風燕子斜。", "source": "杜甫《水檻遣心》" },
{ "id": 233, "text": "映階碧草自春色，隔葉黃鸝空好音。", "source": "杜甫《蜀相》" },
{ "id": 234, "text": "出師未捷身先死，長使英雄淚滿襟。", "source": "杜甫《蜀相》" },
{ "id": 235, "text": "吳楚東南坼，乾坤日夜浮。", "source": "杜甫《登岳陽樓》" },
{ "id": 236, "text": "筆落驚風雨，詩成泣鬼神。", "source": "杜甫《寄李十二白二十韻》" },
{ "id": 237, "text": "敏捷詩千首，飄零酒一杯。", "source": "杜甫《不見》" },
{ "id": 238, "text": "無邊落木蕭蕭下，不盡長江滾滾來。", "source": "杜甫《登高》" },
{ "id": 239, "text": "萬里悲秋常作客，百年多病獨登台。", "source": "杜甫《登高》" },
{ "id": 240, "text": "白日放歌須縱酒，青春作伴好還鄉。", "source": "杜甫《聞官軍收河南河北》" },
{ "id": 241, "text": "安得廣廈千萬間，大庇天下寒士俱歡顏，風雨不動安如山！", "source": "杜甫《茅屋為秋風所破歌》" },
{ "id": 242, "text": "露從今夜白，月是故鄉明。", "source": "杜甫《月夜憶舍弟》" },
{ "id": 243, "text": "朱門酒肉臭，路有凍死骨。", "source": "杜甫《自京赴奉先縣咏懷五百字》" },
{ "id": 244, "text": "烽火連三月，家書抵萬金。", "source": "杜甫《春望》" },
{ "id": 245, "text": "讀書破萬卷，下筆如有神。", "source": "杜甫《奉贈韋左丞丈二十二韻》" },
{ "id": 246, "text": "窗含西嶺千秋雪，門泊東吳萬里船。", "source": "杜甫《絕句》" },
{ "id": 247, "text": "為人性僻耽佳句，語不驚人死不休。", "source": "杜甫《江上值水如海勢聊短述》" },
{ "id": 248, "text": "正是江南好風景，落花時節又逢君。", "source": "杜甫《江南逢李龜年》" },
{ "id": 249, "text": "春潮帶雨晚來急，野渡無人舟自橫。", "source": "韋應物《滁州西澗》" },
{ "id": 250, "text": "誰言寸草心，報得三春暉。", "source": "孟郊《遊子吟》" },
{ "id": 251, "text": "春風得意馬蹄疾，一日看盡長安花。", "source": "孟郊《登科後》" },
{ "id": 252, "text": "人面不知何處去，桃花依舊笑春風。", "source": "崔護《題都城南庄》" },
{ "id": 253, "text": "不塞不流，不止不行。", "source": "韓愈《原道》" },
{ "id": 254, "text": "古之學者必有師。師者，所以傳道受業解惑也。", "source": "韓愈《師說》" },
{ "id": 255, "text": "道之所存，師之所存也。", "source": "韓愈《師說》" },
{ "id": 256, "text": "孔子曰：「三人行，則必有我師。」是故弟子不必不如師，師不必賢於弟子。", "source": "韓愈《師說》" },
{ "id": 257, "text": "天街小雨潤如酥，草色遙看近卻無。", "source": "韓愈《早春呈水部張十八員外》" },
{ "id": 258, "text": "大凡物不得其平則嗚。", "source": "韓愈《送孟東野序》" },
{ "id": 259, "text": "蚍蜉撼大樹，可笑不自量。", "source": "韓愈《調張籍》" },
{ "id": 260, "text": "業精於勤荒於嬉，行成於思毀於隨。", "source": "韓愈《進學解》" },
{ "id": 261, "text": "昆山玉碎鳳凰叫，芙蓉泣露香蘭笑。", "source": "韓愈《李憑箜篌引》" },
{ "id": 262, "text": "女媧煉石補天處，石破天驚逗秋雨。", "source": "韓愈《李憑箜篌引》" },
{ "id": 263, "text": "黑雲壓城城欲摧，甲光向日金鱗開。", "source": "李賀《雁門太守行》" },
{ "id": 264, "text": "大漠沙如雪，燕山月似鈎。", "source": "李賀《馬詩》" },
{ "id": 265, "text": "我有迷魂招不得，雄雞一叫天下白。", "source": "李賀《致酒行》" },
{ "id": 266, "text": "衰蘭送客咸陽道，天若有情天亦老。", "source": "李賀《金銅仙人辭漢歌》" },
{ "id": 267, "text": "千山鳥飛絕，萬徑人踪滅。", "source": "柳宗元《江雪》" },
{ "id": 268, "text": "山圍故國周遭在，潮打空城寂寞回。", "source": "劉禹錫《石頭城》" },
{ "id": 269, "text": "舊時王謝堂前燕，飛入尋常百姓家。", "source": "劉禹錫《烏衣巷》" },
{ "id": 270, "text": "莫道桑榆晚，為霞尚滿天。", "source": "劉禹錫《酬樂天咏老見示》" },
{ "id": 271, "text": "晴空一鶴排雲上，便引詩情到碧霄。", "source": "劉禹錫《秋詞》" },
{ "id": 272, "text": "沉舟側畔千帆過，病樹前頭萬木春。", "source": "劉禹錫《酬樂天揚州初逢席上見贈》" },
{ "id": 273, "text": "東邊日出西邊雨，道是無晴卻有晴。", "source": "劉禹錫《竹枝詞》" },
{ "id": 274, "text": "山不在高，有仙則名；水不在深，有龍則靈。", "source": "劉禹錫《陋室銘》" },
{ "id": 275, "text": "亂花漸欲迷人眼，淺草才能沒馬蹄。", "source": "白居易《錢塘湖春行》" },
{ "id": 276, "text": "一道殘陽鋪水中，半江瑟瑟半江紅。", "source": "白居易《暮江吟》" },
{ "id": 277, "text": "試玉要燒三日滿，辨材須待七年期。", "source": "白居易《放言》" },
{ "id": 278, "text": "野火燒不盡，春風吹又生。", "source": "白居易《賦得古原草送別》" },
{ "id": 279, "text": "文章合為時而著，歌詩合為事而作。", "source": "白居易《與元九書》" },
{ "id": 280, "text": "別有幽愁暗恨生，此時無聲勝有聲。", "source": "白居易《琵琶行》" },
{ "id": 281, "text": "同是天涯淪落人，相逢何必曾相識。", "source": "白居易《琵琶行》" },
{ "id": 282, "text": "在天願作比翼鳥，在地願為連理枝。", "source": "白居易《長恨歌》" },
{ "id": 283, "text": "江南好，風景舊曾諳。日出江花紅勝火，春來江水綠如藍。能不憶江南？", "source": "白居易《憶江南》" },
{ "id": 284, "text": "醉臥沙場君莫笑，古來征戰幾人回？", "source": "王翰《涼州詞》" },
{ "id": 285, "text": "千里鶯啼綠映紅，水村山郭酒旗風。", "source": "杜牧《江南春絕句》" },
{ "id": 286, "text": "清明時節雨紛紛，路上行人欲斷魂。", "source": "杜牧《清明》" },
{ "id": 287, "text": "微雨池塘見，好風襟袖知。", "source": "杜牧《秋思》" },
{ "id": 288, "text": "門外若無南北路，人間應免別離愁。", "source": "杜牧《贈別》" },
{ "id": 289, "text": "停車坐愛楓林晚，霜葉紅於二月花。", "source": "杜牧《山行》" },
{ "id": 290, "text": "商女不知亡國恨，隔江猶唱《後庭花》。", "source": "杜牧《泊秦淮》" },
{ "id": 291, "text": "二十四橋明月夜，玉人何處教吹簫。", "source": "杜牧《寄揚州韓綽判官》" },
{ "id": 292, "text": "歷覽前賢國與家，成由勤儉敗（破）由奢。", "source": "李商隠《詠史》" },
{ "id": 293, "text": "春蠶到死絲方盡，蠟炬成灰淚始乾。", "source": "李商隠《無題》" },
{ "id": 294, "text": "身無彩鳳雙飛翼，心有靈犀一點通。", "source": "李商隠《無題》" },
{ "id": 295, "text": "莊生曉夢迷蝴蝶，望帝春心托杜鵑。", "source": "李商隠《錦瑟》" },
{ "id": 296, "text": "滄海月明珠有淚，藍田日暖玉生煙。", "source": "李商隠《錦瑟》" },
{ "id": 297, "text": "桐花萬里丹山路，雛鳳清於老鳳聲。", "source": "李商隠《韓冬郎即席爲詩相送，一座盡驚。他日余方追吟「連宵侍坐裴回久」之句，有老成之風，因成二絕寄酬，兼呈畏之員外》" },
{ "id": 298, "text": "夕陽無限好，只是近黃昏。", "source": "李商隠《樂遊原》" },
{ "id": 299, "text": "天意憐幽草，人間重晚情。", "source": "李商隠《晚情》" },
{ "id": 300, "text": "曾經滄海難為水，除卻巫山不是雲。", "source": "元稹《離思》" }
     ];

    // 遊戲狀態
    let cards = [];
    let firstCard = null, secondCard = null;
    let lockBoard = false;
    let matchedCount = 0;
    let totalPairs = 5; // 預設5組
    let selectedQuotes = []; // 當前選中的名句

    // 計時器狀態
    let timerInterval = null;
    let startTime = 0;
    let elapsed = 0;
    let running = false;
    let gameStarted = false;
    let isPaused = false;

    const boardEl = document.getElementById('game-board');
    const statusEl = document.getElementById('status');
    const timerEl = document.getElementById('timer');
    const bestEl = document.getElementById('best');
    const pairsEl = document.getElementById('pairs');
    const totalPairsEl = document.getElementById('total-pairs');
    const btnNew = document.getElementById('btn-new');
    const btnPause = document.getElementById('btn-pause');
    const btnResume = document.getElementById('btn-resume');
    const btnHome = document.getElementById('btn-home');
    const pairCountSelect = document.getElementById('pair-count');
    const answerContainerEl = document.getElementById('answer-container');
    
    // 手機版按鈕
    const mobileNew = document.getElementById('mobile-new');
    const mobilePause = document.getElementById('mobile-pause');
    const mobileResume = document.getElementById('mobile-resume');
    const mobileHome = document.getElementById('mobile-home');

    // 工具：洗牌
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // 取隨機名句組
    function pickRandomQuotes(num) {
      // 確保不超過可用名句數量
      const availableQuotes = [...quotes];
      if (num > availableQuotes.length) {
        num = availableQuotes.length;
      }
      
      const indices = shuffle([...Array(availableQuotes.length).keys()]);
      return indices.slice(0, num).map(i => availableQuotes[i]);
    }

    // 初始化答案欄
    function initAnswerBoard() {
      answerContainerEl.innerHTML = '';
      selectedQuotes.forEach((quote) => {
        const pairDiv = document.createElement('div');
        pairDiv.className = 'answer-pair';
        pairDiv.id = `answer-pair-${quote.id}`;
        
        // 添加序號（初始隱藏）
        const numberDiv = document.createElement('div');
        numberDiv.className = 'pair-number';
        numberDiv.textContent = quote.id;
        numberDiv.style.display = 'none'; // 初始隱藏
        
        const textDiv = document.createElement('div');
        textDiv.className = 'answer-text';
        textDiv.innerHTML = '<span class="answer-placeholder">等待配對...</span>';
        const textType = document.createElement('div');
        textType.className = 'answer-type';
        textType.textContent = '名句';
        textDiv.appendChild(textType);
        
        const sourceDiv = document.createElement('div');
        sourceDiv.className = 'answer-source';
        sourceDiv.innerHTML = '<span class="answer-placeholder">等待配對...</span>';
        const sourceType = document.createElement('div');
        sourceType.className = 'answer-type';
        sourceType.textContent = '出處';
        sourceDiv.appendChild(sourceType);
        
        pairDiv.appendChild(numberDiv);
        pairDiv.appendChild(textDiv);
        pairDiv.appendChild(sourceDiv);
        answerContainerEl.appendChild(pairDiv);
      });
    }

    // 更新答案欄
    function updateAnswerBoard(quoteId, text, source) {
      const pairDiv = document.getElementById(`answer-pair-${quoteId}`);
      if (pairDiv) {
        // 顯示序號
        const numberDiv = pairDiv.querySelector('.pair-number');
        numberDiv.style.display = 'flex';
        setTimeout(() => {
          numberDiv.classList.add('visible');
        }, 10);
        
        const textDiv = pairDiv.querySelector('.answer-text');
        const sourceDiv = pairDiv.querySelector('.answer-source');
        
        textDiv.innerHTML = text;
        const textType = document.createElement('div');
        textType.className = 'answer-type';
        textType.textContent = '名句';
        textDiv.appendChild(textType);
        
        sourceDiv.innerHTML = source;
        const sourceType = document.createElement('div');
        sourceType.className = 'answer-type';
        sourceType.textContent = '出處';
        sourceDiv.appendChild(sourceType);
        
        // 添加動畫效果
        textDiv.style.animation = 'none';
        sourceDiv.style.animation = 'none';
        setTimeout(() => {
          textDiv.style.animation = 'popIn 0.5s ease';
          sourceDiv.style.animation = 'popIn 0.5s ease';
        }, 10);
      }
    }

    // 計時器：格式化
    function formatTime(ms) {
      const totalMs = Math.max(0, ms | 0);
      const totalSec = Math.floor(totalMs / 1000);
      const min = Math.floor(totalSec / 60);
      const sec = totalSec % 60;
      const deci = Math.floor((totalMs % 1000) / 100);
      const mm = String(min).padStart(2, '0');
      const ss = String(sec).padStart(2, '0');
      return `${mm}:${ss}.${deci}`;
    }

    // 計時器：更新畫面
    function updateTimerDisplay() {
      timerEl.textContent = formatTime(elapsed);
    }

    // 計時器：開始
    function startTimer() {
      if (running) return;
      running = true;
      gameStarted = true;
      startTime = performance.now();
      timerInterval = setInterval(() => {
        const now = performance.now();
        elapsed += (now - startTime);
        startTime = now;
        updateTimerDisplay();
      }, 100);
    }

    // 計時器：暫停
    function pauseTimer() {
      if (!running) return;
      running = false;
      clearInterval(timerInterval);
      timerInterval = null;
    }

    // 計時器：恢復
    function resumeTimer() {
      if (running) return;
      running = true;
      startTime = performance.now();
      timerInterval = setInterval(() => {
        const now = performance.now();
        elapsed += (now - startTime);
        startTime = now;
        updateTimerDisplay();
      }, 100);
    }

    // 計時器：重置
    function resetTimer() {
      pauseTimer();
      elapsed = 0;
      running = false;
      gameStarted = false;
      updateTimerDisplay();
      btnPause.style.display = '';
      btnResume.style.display = 'none';
      mobilePause.style.display = '';
      mobileResume.style.display = 'none';
      isPaused = false;
    }

    // 最佳成績
    const BEST_KEY = 'match-quote-best-time-ms';
    function loadBest() {
      const v = localStorage.getItem(BEST_KEY);
      if (v && !isNaN(+v)) {
        bestEl.textContent = formatTime(+v);
      } else {
        bestEl.textContent = '—';
      }
    }
    
    function saveBestIfBetter(ms) {
      const v = localStorage.getItem(BEST_KEY);
      if (!v || ms < +v) {
        localStorage.setItem(BEST_KEY, String(ms));
        bestEl.textContent = formatTime(ms);
      }
    }

    // 顯示完成訊息
    function showCompletionMessage() {
      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      
      const messageDiv = document.createElement('div');
      messageDiv.className = 'completed-message';
      messageDiv.innerHTML = `
        <h2>恭喜完成！</h2>
        <p>您用時: ${formatTime(elapsed)}</p>
        <p>${elapsed < 60000 ? '🎉 太棒了！' : '👍 做得很好！'}</p>
        <button class="btn" onclick="this.parentElement.parentElement.remove()">繼續遊戲</button>
      `;
      
      overlay.appendChild(messageDiv);
      document.body.appendChild(overlay);
    }

    // 開新局
    function newGame() {
      statusEl.textContent = '請翻開兩張卡牌進行配對';
      matchedCount = 0;
      firstCard = null; 
      secondCard = null; 
      lockBoard = false;

      // 獲取選擇的難度
      totalPairs = parseInt(pairCountSelect.value);
      totalPairsEl.textContent = totalPairs;
      pairsEl.textContent = '0';

      // 選取名句
      selectedQuotes = pickRandomQuotes(totalPairs);

      // 初始化答案欄
      initAnswerBoard();

      // 建立卡牌
      cards = [];
      selectedQuotes.forEach((item) => {
        cards.push({ id: item.id, type: 'text', value: item.text });
        cards.push({ id: item.id, type: 'source', value: item.source });
      });
      shuffle(cards);

      // 渲染
      boardEl.innerHTML = '';
      cards.forEach((card, i) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.dataset.idx = i;
        div.dataset.id = card.id;
        div.dataset.type = card.type;
        
        // 卡片正面 - 顯示"翻牌"
        const cardFront = document.createElement('div');
        cardFront.className = 'card-front';
        cardFront.innerText = '翻牌';
        
        // 卡片背面 - 顯示內容
        const cardBack = document.createElement('div');
        cardBack.className = 'card-back';
        cardBack.innerText = card.value;
        
        div.appendChild(cardFront);
        div.appendChild(cardBack);
        
        boardEl.appendChild(div);
      });

      // 根據難度調整網格
      if (totalPairs <= 5) {
        boardEl.style.gridTemplateColumns = 'repeat(5, 1fr)';
      } else if (totalPairs <= 8) {
        boardEl.style.gridTemplateColumns = 'repeat(4, 1fr)';
      } else {
        boardEl.style.gridTemplateColumns = 'repeat(5, 1fr)';
      }

      // 重置計時器
      resetTimer();
      
      // 重新綁定卡片點擊事件
      bindCardEvents();
    }

    // 綁定卡片事件
    function bindCardEvents() {
      const cardElements = boardEl.querySelectorAll('.card');
      cardElements.forEach((div, i) => {
        const card = cards[i];
        // 移除舊的事件監聽器
        div.onclick = null;
        div.ontouchstart = null;
        
        // 添加新的事件監聽器
        div.addEventListener('click', () => flipCard(div, card, i));
        div.addEventListener('touchstart', (e) => {
          if (e.touches.length === 1) {
            e.preventDefault();
            flipCard(div, card, i);
          }
        }, { passive: false });
      });
    }

    // 翻牌
    function flipCard(div, card, idx) {
      if (lockBoard || isPaused || div.classList.contains('matched')) return;
      if (div.classList.contains('flipped')) return;

      // 第一次翻牌才開啟計時
      if (!gameStarted) {
        startTimer();
      }

      div.classList.add('flipped');

      if (!firstCard) {
        firstCard = { div, card, idx };
      } else {
        secondCard = { div, card, idx };
        lockBoard = true;

        // 檢查配對
        if (
          firstCard.card.id === secondCard.card.id &&
          firstCard.card.type !== secondCard.card.type
        ) {
          // 配對成功
          setTimeout(() => {
            firstCard.div.classList.add('matched');
            secondCard.div.classList.add('matched');
            
            // 更新答案欄
            const quote = selectedQuotes.find(q => q.id === firstCard.card.id);
            if (quote) {
              updateAnswerBoard(quote.id, quote.text, quote.source);
            }
            
            matchedCount++;
            pairsEl.textContent = matchedCount;
            resetTurn();

            if (matchedCount === totalPairs) {
              pauseTimer();
              statusEl.textContent = `恭喜你全部配對成功！用時：${formatTime(elapsed)}`;
              saveBestIfBetter(elapsed);
              setTimeout(showCompletionMessage, 500);
            }
          }, 500);
        } else {
          // 配對失敗
          setTimeout(() => {
            firstCard.div.classList.remove('flipped');
            secondCard.div.classList.remove('flipped');
            resetTurn();
          }, 1000);
        }
      }
    }

    function resetTurn() {
      [firstCard, secondCard] = [null, null];
      lockBoard = false;
    }

    // 按鈕事件
    function setupButtonEvents() {
      // 桌面版按鈕
      btnNew.addEventListener('click', newGame);
      btnPause.addEventListener('click', pauseGame);
      btnResume.addEventListener('click', resumeGame);
      btnHome.addEventListener('click', goHome);
      
      // 手機版按鈕
      mobileNew.addEventListener('click', newGame);
      mobilePause.addEventListener('click', pauseGame);
      mobileResume.addEventListener('click', resumeGame);
      mobileHome.addEventListener('click', goHome);
    }
    
    function pauseGame() {
      pauseTimer();
      isPaused = true;
      btnPause.style.display = 'none';
      btnResume.style.display = '';
      mobilePause.style.display = 'none';
      mobileResume.style.display = '';
      statusEl.textContent = '已暫停。點選「繼續」繼續遊戲。';
    }
    
    function resumeGame() {
      resumeTimer();
      isPaused = false;
      btnPause.style.display = '';
      btnResume.style.display = 'none';
      mobilePause.style.display = '';
      mobileResume.style.display = 'none';
      statusEl.textContent = '請翻開兩張卡牌進行配對';
    }
    
    function goHome() {
      window.location.href = "https://mbcchinesegroup.github.io/MBC/400homepage.html";
    }

    // 難度選擇事件
    pairCountSelect.addEventListener('change', newGame);

    // 初始化
    function init() {
      loadBest();
      setupButtonEvents();
      newGame();
    }

    // 啟動遊戲
    init();
  </script>
</body>
</html>
