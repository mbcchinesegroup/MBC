<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>101-200名句配對消消樂遊戲</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", Arial, sans-serif;
      background: linear-gradient(135deg, #f4f8fb 0%, #e0eaf8 100%);
      margin: 0; padding: 0;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
    }
    h1 { 
      margin: 20px 0 6px; 
      color: #1976d2;
      text-align: center;
    }
    .container {
      width: 95%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .topbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 12px 18px;
      margin: 6px 12px 10px;
      font-size: 16px;
      width: 100%;
    }
    .stat {
      background: #fff;
      border-radius: 8px;
      padding: 8px 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      min-width: 120px;
      text-align: center;
      border-left: 4px solid #1976d2;
    }
    #status { 
      margin: 6px 0 10px; 
      font-size: 18px; 
      font-weight: bold;
      color: #333;
      text-align: center;
      padding: 8px 16px;
      background: rgba(255,255,255,0.7);
      border-radius: 20px;
    }
    .game-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      max-width: 1000px;
      width: 100%;
      margin: 10px auto 20px;
    }
    .card {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: #fff;
      border-radius: 10px;
      height: 120px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      user-select: none;
      padding: 10px;
      text-align: center;
      overflow: hidden;
    }
    .card:active { transform: scale(0.98); }
    .card.flipped {
      background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
      color: #222;
      cursor: default;
    }
    .card.matched {
      background: linear-gradient(135deg, #a5d6a7 0%, #66bb6a 100%);
      color: #2e7d32;
      cursor: default;
      box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
    }
    .card.mismatched {
      background: linear-gradient(135deg, #ffcdd2 0%, #ef9a9a 100%);
      color: #c62828;
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      backface-visibility: hidden;
      transition: transform 0.6s;
      border-radius: 10px;
      padding: 10px;
      box-sizing: border-box;
    }
    .card-front {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: white;
      font-weight: bold;
    }
    .card-back {
      background: white;
      color: #222;
      transform: rotateY(180deg);
      justify-content: center;
    }
    .card.flipped .card-front {
      transform: rotateY(180deg);
    }
    .card.flipped .card-back {
      transform: rotateY(0deg);
    }
    button {
      margin: 6px 0 4px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background: #1976d2;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    button:hover {
      background: #1565c0;
      transform: translateY(-2px);
    }
    button:active { transform: translateY(1px); }
    .controls {
      display: flex; 
      gap: 10px; 
      flex-wrap: wrap; 
      justify-content: center;
      margin-bottom: 6px;
      width: 100%;
    }
    .settings {
      display: flex;
      gap: 10px;
      margin: 10px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .setting-item {
      display: flex;
      align-items: center;
      gap: 5px;
      background: white;
      padding: 8px 12px;
      border-radius: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .note { 
      font-size: 14px; 
      color: #555; 
      margin-top: 4px; 
      text-align: center;
      max-width: 600px;
    }
    .completed-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      padding: 30px 40px;
      border-radius: 15px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.2);
      text-align: center;
      z-index: 100;
      animation: popIn 0.5s ease;
    }
    
    /* 答案欄樣式 */
    #answer-board {
      width: 100%;
      max-width: 1000px;
      margin: 20px 0;
      padding: 15px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    #answer-board h2 {
      text-align: center;
      color: #1976d2;
      margin-top: 0;
      padding-bottom: 10px;
      border-bottom: 2px solid #1976d2;
    }
    .answer-pair {
      display: flex;
      margin-bottom: 15px;
      border-bottom: 1px dashed #ccc;
      padding-bottom: 15px;
      align-items: center;
      min-height: 80px;
    }
    .answer-pair:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .pair-number {
      width: 30px;
      height: 30px;
      background: #1976d2;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 10px;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .pair-number.visible {
      opacity: 1;
    }
    .answer-text, .answer-source {
      flex: 1;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 8px;
      margin: 0 5px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
      position: relative;
    }
    .answer-text {
      border-left: 4px solid #4caf50;
    }
    .answer-source {
      border-left: 4px solid #2196f3;
    }
    .answer-type {
      position: absolute;
      top: 5px;
      left: 10px;
      font-size: 12px;
      color: #888;
    }
    .answer-placeholder {
      color: #999;
      font-style: italic;
    }
    
    @keyframes popIn {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 99;
    }
    @media (max-width: 1000px) {
      #game-board { grid-template-columns: repeat(4, 1fr); }
    }
    @media (max-width: 800px) {
      #game-board { grid-template-columns: repeat(3, 1fr); }
      .card { height: 100px; font-size: 14px; }
      .answer-pair { flex-direction: column; }
      .answer-text, .answer-source { margin: 5px 0; width: 100%; }
      .pair-number { margin: 0 0 5px 0; }
    }
    @media (max-width: 600px) {
      #game-board { grid-template-columns: repeat(2, 1fr); }
      .card { height: 90px; }
      .stat { min-width: auto; font-size: 14px; }
      h1 { font-size: 1.5rem; }
    }
    @media (max-width: 400px) {
      #game-board { grid-template-columns: repeat(2, 1fr); }
      .card { height: 80px; font-size: 12px; padding: 5px; }
    }

    .btn { 
      margin: 6px 0 4px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background: #1976d2;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <div style="text-align: center; margin: 15px 0; width: 100%;">
 </div>
<h1>中文組</h1>
    <h1>101-200名句配對消消樂</h1>
    <div class="topbar">
      <div class="stat">計時：<span id="timer">00:00.0</span></div>
      <div class="stat">配對：<span id="pairs">0</span>/<span id="total-pairs">0</span></div>
      <div class="stat">最佳：<span id="best">—</span></div>
    </div>

    <div id="status">請翻開兩張卡牌進行配對</div>

    <div class="settings">
      <div class="setting-item">
        <label for="pair-count">遊戲難度:</label>
        <select id="pair-count">
          <option value="5">簡單 (5組)</option>
          <option value="8">中等 (8組)</option>
          <option value="10">困難 (10組)</option>
        </select>
      </div>
    </div>

    <div class="controls">
      <button id="btn-home" class="btn">主頁</button>
      <button id="btn-new" class="btn">重新開始</button>
      <button id="btn-pause" class="btn">暫停</button>
      <button id="btn-resume" class="btn" style="display:none;">繼續</button>
    </div>
    <div class="note">提示：翻牌開始即計時，全部配對完成自動停止。配對成功時卡片會移動到下方答案欄。</div>

    <div class="game-container">
      <div id="game-board"></div>
    </div>
    
    <!-- 答案欄 -->
    <div id="answer-board">
      <h2>答案欄</h2>
      <div id="answer-container"></div>
    </div>
  </div>

  <script>
    // 完整的名句列表（帶有序號）
    const quotes = [
    
{ "id": 1, "text": "靡不有初，鮮克有終。", "source": "《詩經‧大雅‧蕩》" },
{ "id": 2, "text": "投我以桃，報之以李。", "source": "《詩經‧大雅‧抑》" },
{ "id": 3, "text": "他山之石，可以攻玉。", "source": "《詩經‧小雅‧鶴鳴》" },
{ "id": 4, "text": "昔我往矣，楊柳依依，今我來思，雨雪霏霏。", "source": "《詩經‧小雅‧采薇》" },
{ "id": 5, "text": "戰戰兢兢，如臨深淵，如履薄冰。", "source": "《詩經‧小雅‧小旻》" },
{ "id": 6, "text": "高山仰止，景行行止。", "source": "《詩經‧小雅‧車轄》" },
{ "id": 7, "text": "嚶其鳴矣，求其友聲。", "source": "《詩經‧小雅‧伐木》" },
{ "id": 8, "text": "如切如磋，如琢如磨。", "source": "《詩經‧衛風‧淇奧》" },
{ "id": 9, "text": "投我以木瓜，報之以瓊琚。", "source": "《詩經‧衛風‧木瓜》" },
{ "id": 10, "text": "關關雎鳩，在河之洲。窈窕淑女，君子好逑。", "source": "《詩經‧周南‧關雎》" },
{ "id": 11, "text": "風雨如晦，雞鳴不已。", "source": "《詩經‧鄭風‧風雨》" },
{ "id": 12, "text": "人而無儀，不死何為！", "source": "《詩經‧鄘風‧相鼠》" },
{ "id": 13, "text": "所謂伊人，在水一方。", "source": "《詩經‧秦風‧蒹葭》" },
{ "id": 14, "text": "一日不見，如三秋兮。", "source": "《詩經‧王風‧采葛》" },
{ "id": 15, "text": "路曼曼其修遠兮，吾將上下而求索。", "source": "屈原《離騷》" },
{ "id": 16, "text": "惟草木之零落兮，恐美人之遲暮。", "source": "屈原《離騷》" },
{ "id": 17, "text": "長太息以掩涕兮，哀民生之多艱。", "source": "屈原《離騷》" },
{ "id": 18, "text": "亦余心之所善兮，雖九死其猶未悔。", "source": "屈原《離騷》" },
{ "id": 19, "text": "與天地兮同壽，與日月兮齊光。", "source": "屈原《九章‧涉江》" },
{ "id": 20, "text": "吾不能變心而從俗兮，固將愁苦而終窮。", "source": "屈原《九章‧涉江》" },
{ "id": 21, "text": "鳥飛反故鄉兮，狐死必首丘。", "source": "屈原《九章‧哀郢》" },
{ "id": 22, "text": "身既死兮神以靈，魂魄毅兮為鬼雄。", "source": "屈原《九歌‧國殤》" },
{ "id": 23, "text": "舉世皆濁我獨清，眾人皆醉我獨醒。", "source": "屈原《漁父》" },
{ "id": 24, "text": "尺有所短，寸有所長。", "source": "屈原《卜居》" },
{ "id": 25, "text": "其曲彌高，其和彌寡。", "source": "宋玉《對楚王問》" },
{ "id": 26, "text": "滿招損，謙受益。", "source": "《尚書‧大禹謨》" },
{ "id": 27, "text": "輔車相依，唇亡齒寒。", "source": "《左傳‧僖公五年》" },
{ "id": 28, "text": "欲加之罪，其無辭乎（何患無辭）。", "source": "《左傳‧僖公十年》" },
{ "id": 29, "text": "居安思危，思則有備，有備無患。", "source": "《左傳‧襄公十一年》" },
{ "id": 30, "text": "外舉不棄仇，內舉不失親。", "source": "《左傳‧襄公二十一年》" },
{ "id": 31, "text": "人心之不同，如其面焉。", "source": "《左傳‧襄公三十一年》" },
{ "id": 32, "text": "人誰無過？過而能改，善莫大焉。", "source": "《左傳‧宣公二年》" },
{ "id": 33, "text": "多行不義必自斃。", "source": "《左傳‧隱公元年》" },
{ "id": 34, "text": "防民之口，甚於防川。", "source": "《國語‧周語上》" },
{ "id": 35, "text": "前事不忘，後事之師。", "source": "《戰國策‧趙策一》" },
{ "id": 36, "text": "士為知己者死，女為悅己者容。", "source": "《戰國策‧趙策一》" },
{ "id": 37, "text": "亡羊而補牢，猶未遲也。", "source": "《戰國策‧楚策一》" },
{ "id": 38, "text": "日中則移，月滿則虧，物盛則衰。", "source": "《戰國策‧秦策三》" },
{ "id": 39, "text": "鷸蚌相爭，漁翁得利。", "source": "《戰國策‧燕策二》" },
{ "id": 40, "text": "知己知彼，百戰不殆。", "source": "孫武《孫子兵法‧謀攻》" },
{ "id": 41, "text": "功成而弗居。夫唯弗居，是以不去。", "source": "老子《道德經‧二章》" },
{ "id": 42, "text": "見素抱樸，少私寡欲。", "source": "《老子‧十九章》" },
{ "id": 43, "text": "曲則全，枉則直。", "source": "老子《道德經‧二十二章》" },
{ "id": 44, "text": "知人者智，自知者明。", "source": "老子《道德經‧三十三章》" },
{ "id": 45, "text": "大方無隅，大器晚成，大音希聲，大象無形。", "source": "老子《道德經‧四十一章》" },
{ "id": 46, "text": "知足不辱，知止不殆。", "source": "老子《道德經‧四十四章》" },
{ "id": 47, "text": "大直若屈，大巧若拙。", "source": "老子《道德經‧四十五章》" },
{ "id": 48, "text": "禍兮福之所倚，福兮禍之所伏。", "source": "老子《道德經‧五十八章》" },
{ "id": 49, "text": "千里之行，始於足下。", "source": "老子《道德經‧六十四章》" },
{ "id": 50, "text": "天網恢恢，疏而不漏。", "source": "老子《道德經‧七十三章》" },
{ "id": 51, "text": "民不畏死，奈何以死懼之。", "source": "老子《道德經‧七十四章》" },
{ "id": 52, "text": "信言不美，美言不信。", "source": "老子《道德經‧八十一章》" },
{ "id": 53, "text": "天之道，利而不害。", "source": "老子《道德經‧八十一章》" },
{ "id": 54, "text": "仁者見之謂之仁，智者見之謂之知。", "source": "《周易‧繫辭上》" },
{ "id": 55, "text": "天行健，君子以自強不息。地勢坤，君子以厚德載物。", "source": "《周易‧象傳》" },
{ "id": 56, "text": "與朋友交，言而有信。", "source": "《論語‧學而》" },
{ "id": 57, "text": "敏於事而慎於言，就有道而正焉。", "source": "《論語‧學而》" },
{ "id": 58, "text": "不患人之不己知，患不知人也。", "source": "《論語‧學而》" },
{ "id": 59, "text": "學而不思則罔，思而不學則殆。", "source": "《論語‧為政》" },
{ "id": 60, "text": "溫故而知新，可以為師矣。", "source": "《論語‧為政》" },
{ "id": 61, "text": "君子周而不比，小人比而不周。", "source": "《論語‧為政》" },
{ "id": 62, "text": "敏而好學，不耻下問。", "source": "《論語‧公冶長》" },
{ "id": 63, "text": "知之者不如好之者，好之者不如樂之者。", "source": "《論語‧雍也》" },
{ "id": 64, "text": "知者樂水，仁者樂山。", "source": "《論語‧雍也》" },
{ "id": 65, "text": "學而不厭，誨人不倦。", "source": "《論語‧述而》" },
{ "id": 66, "text": "君子坦蕩蕩，小人長戚戚。", "source": "《論語‧述而》" },
{ "id": 67, "text": "不憤不啟，不悱不發。", "source": "《論語‧述而》" },
{ "id": 68, "text": "發憤忘食，樂以忘憂，不知老之將至。", "source": "《論語‧述而》" },
{ "id": 69, "text": "子在川上曰：「逝者如斯夫！不捨晝夜。」", "source": "《論語‧子罕》" },
{ "id": 70, "text": "三軍可奪帥也，匹夫不可奪志也。", "source": "《論語‧子罕》" },
{ "id": 71, "text": "歲寒，然後知松柏之後凋也。", "source": "《論語‧子罕》" },
{ "id": 72, "text": "後生可畏，焉知來者之不如今也。", "source": "《論語‧子罕》" },
{ "id": 73, "text": "仰之彌高，鑽之彌堅。", "source": "《論語‧子罕》" },
{ "id": 74, "text": "己所不欲，勿施於人。", "source": "《論語‧顏淵》" },
{ "id": 75, "text": "工欲善其事，必先利其器。", "source": "《論語‧衛靈公》" },
{ "id": 76, "text": "人無遠慮，必有近憂。", "source": "《論語‧衛靈公》" },
{ "id": 77, "text": "君子不以言舉人，不以人廢言。", "source": "《論語‧衛靈公》" },
{ "id": 78, "text": "君子求諸己，小人求諸人。", "source": "《論語‧衛靈公》" },
{ "id": 79, "text": "既來之，則安之。", "source": "《論語‧季氏》" },
{ "id": 80, "text": "陳力就列，不能者止。", "source": "《論語‧季氏》" },
{ "id": 81, "text": "不患寡而患不均，不患貧而患不安。", "source": "《論語‧季氏》" },
{ "id": 82, "text": "朝聞道，夕死可矣。", "source": "《論語‧里仁》" },
{ "id": 83, "text": "君子喻於義，小人喻於利。", "source": "《論語‧里仁》" },
{ "id": 84, "text": "見賢思齊焉，見不賢而內自省也。", "source": "《論語‧里仁》" },
{ "id": 85, "text": "不在其位，不謀其政。", "source": "《論語‧泰伯》" },
{ "id": 86, "text": "士不可以不弘毅，任重而道遠。", "source": "《論語‧泰伯》" },
{ "id": 87, "text": "其身正，不令而行；其身不正，雖令不從。", "source": "《論語‧子路》" },
{ "id": 88, "text": "言必信，行必果。", "source": "《論語‧子路》" },
{ "id": 89, "text": "往者不可諫，來者猶可追。", "source": "《論語‧微子》" },
{ "id": 90, "text": "竊鈎者誅，竊國者為諸侯。", "source": "《莊子‧胠篋》" },
{ "id": 91, "text": "吾生也有涯，而知也無涯。", "source": "《莊子‧養生主》" },
{ "id": 92, "text": "朝菌不知晦朔，蟪蛄不知春秋。", "source": "《莊子‧逍遙游》" },
{ "id": 93, "text": "君子之交淡若水，小人之交甘若醴。", "source": "《莊子‧山木》" },
{ "id": 94, "text": "橘生淮南則為橘，生於淮北則為枳。", "source": "《晏子春秋‧雜下》" },
{ "id": 95, "text": "十年樹木，百年樹人。", "source": "《管子‧權修》" },
{ "id": 96, "text": "窮則獨善其身，達則兼善（濟）天下。", "source": "《孟子‧盡心上》" },
{ "id": 97, "text": "民為貴，社稷次之，君為輕。", "source": "《孟子‧盡心下》" },
{ "id": 98, "text": "盡信書，則不如無書。", "source": "《孟子‧盡心下》" },
{ "id": 99, "text": "老吾老，以及人之老；幼吾幼，以及人之幼。", "source": "《孟子‧梁惠王上》" },
{ "id": 100, "text": "天時不如地利，地利不如人和。", "source": "《孟子‧公孫丑下》" }

     ];
// 遊戲狀態
    let cards = [];
    let firstCard = null, secondCard = null;
    let lockBoard = false;
    let matchedCount = 0;
    let totalPairs = 5; // 預設5組
    let selectedQuotes = []; // 當前選中的名句

    // 計時器狀態
    let timerInterval = null;
    let startTime = 0;
    let elapsed = 0;
    let running = false;
    let gameStarted = false;
    let isPaused = false;

    const boardEl = document.getElementById('game-board');
    const statusEl = document.getElementById('status');
    const timerEl = document.getElementById('timer');
    const bestEl = document.getElementById('best');
    const pairsEl = document.getElementById('pairs');
    const totalPairsEl = document.getElementById('total-pairs');
    const btnNew = document.getElementById('btn-new');
    const btnPause = document.getElementById('btn-pause');
    const btnResume = document.getElementById('btn-resume');
    const btnHome = document.getElementById('btn-home');
    const pairCountSelect = document.getElementById('pair-count');
    const answerContainerEl = document.getElementById('answer-container');

    // 工具：洗牌
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // 取隨機名句組
    function pickRandomQuotes(num) {
      // 確保不超過可用名句數量
      const availableQuotes = [...quotes];
      if (num > availableQuotes.length) {
        num = availableQuotes.length;
      }
      
      const indices = shuffle([...Array(availableQuotes.length).keys()]);
      return indices.slice(0, num).map(i => availableQuotes[i]);
    }

    // 初始化答案欄
    function initAnswerBoard() {
      answerContainerEl.innerHTML = '';
      selectedQuotes.forEach((quote) => {
        const pairDiv = document.createElement('div');
        pairDiv.className = 'answer-pair';
        pairDiv.id = `answer-pair-${quote.id}`;
        
        // 添加序號（初始隱藏）
        const numberDiv = document.createElement('div');
        numberDiv.className = 'pair-number';
        numberDiv.textContent = quote.id;
        numberDiv.style.display = 'none'; // 初始隱藏
        
        const textDiv = document.createElement('div');
        textDiv.className = 'answer-text';
        textDiv.innerHTML = '<span class="answer-placeholder">等待配對...</span>';
        const textType = document.createElement('div');
        textType.className = 'answer-type';
        textType.textContent = '名句';
        textDiv.appendChild(textType);
        
        const sourceDiv = document.createElement('div');
        sourceDiv.className = 'answer-source';
        sourceDiv.innerHTML = '<span class="answer-placeholder">等待配對...</span>';
        const sourceType = document.createElement('div');
        sourceType.className = 'answer-type';
        sourceType.textContent = '出處';
        sourceDiv.appendChild(sourceType);
        
        pairDiv.appendChild(numberDiv);
        pairDiv.appendChild(textDiv);
        pairDiv.appendChild(sourceDiv);
        answerContainerEl.appendChild(pairDiv);
      });
    }

    // 更新答案欄
    function updateAnswerBoard(quoteId, text, source) {
      const pairDiv = document.getElementById(`answer-pair-${quoteId}`);
      if (pairDiv) {
        // 顯示序號
        const numberDiv = pairDiv.querySelector('.pair-number');
        numberDiv.style.display = 'flex';
        setTimeout(() => {
          numberDiv.classList.add('visible');
        }, 10);
        
        const textDiv = pairDiv.querySelector('.answer-text');
        const sourceDiv = pairDiv.querySelector('.answer-source');
        
        textDiv.innerHTML = text;
        const textType = document.createElement('div');
        textType.className = 'answer-type';
        textType.textContent = '名句';
        textDiv.appendChild(textType);
        
        sourceDiv.innerHTML = source;
        const sourceType = document.createElement('div');
        sourceType.className = 'answer-type';
        sourceType.textContent = '出處';
        sourceDiv.appendChild(sourceType);
        
        // 添加動畫效果
        textDiv.style.animation = 'none';
        sourceDiv.style.animation = 'none';
        setTimeout(() => {
          textDiv.style.animation = 'popIn 0.5s ease';
          sourceDiv.style.animation = 'popIn 0.5s ease';
        }, 10);
      }
    }

    // 計時器：格式化
    function formatTime(ms) {
      const totalMs = Math.max(0, ms | 0);
      const totalSec = Math.floor(totalMs / 1000);
      const min = Math.floor(totalSec / 60);
      const sec = totalSec % 60;
      const deci = Math.floor((totalMs % 1000) / 100);
      const mm = String(min).padStart(2, '0');
      const ss = String(sec).padStart(2, '0');
      return `${mm}:${ss}.${deci}`;
    }

    // 計時器：更新畫面
    function updateTimerDisplay() {
      timerEl.textContent = formatTime(elapsed);
    }

    // 計時器：開始
    function startTimer() {
      if (running) return;
      running = true;
      startTime = performance.now();
      timerInterval = setInterval(() => {
        const now = performance.now();
        elapsed += (now - startTime);
        startTime = now;
        updateTimerDisplay();
      }, 100);
    }

    // 計時器：暫停
    function pauseTimer() {
      if (!running) return;
      running = false;
      clearInterval(timerInterval);
      timerInterval = null;
    }

    // 計時器：恢復
    function resumeTimer() {
      if (running) return;
      running = true;
      startTime = performance.now();
      timerInterval = setInterval(() => {
        const now = performance.now();
        elapsed += (now - startTime);
        startTime = now;
        updateTimerDisplay();
      }, 100);
    }

    // 計時器：重置
    function resetTimer() {
      pauseTimer();
      elapsed = 0;
      running = false;
      gameStarted = false;
      updateTimerDisplay();
      btnPause.style.display = '';
      btnResume.style.display = 'none';
      isPaused = false;
    }

    // 最佳成績
    const BEST_KEY = 'match-quote-best-time-ms';
    function loadBest() {
      const v = localStorage.getItem(BEST_KEY);
      if (v && !isNaN(+v)) {
        bestEl.textContent = formatTime(+v);
      } else {
        bestEl.textContent = '—';
      }
    }
    
    function saveBestIfBetter(ms) {
      const v = localStorage.getItem(BEST_KEY);
      if (!v || ms < +v) {
        localStorage.setItem(BEST_KEY, String(ms));
        bestEl.textContent = formatTime(ms);
      }
    }

    // 顯示完成訊息
    function showCompletionMessage() {
      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      
      const messageDiv = document.createElement('div');
      messageDiv.className = 'completed-message';
      messageDiv.innerHTML = `
        <h2>恭喜完成！</h2>
        <p>您用時: ${formatTime(elapsed)}</p>
        <p>${elapsed < 60000 ? '🎉 太棒了！' : '👍 做得很好！'}</p>
        <button class="btn" onclick="this.parentElement.parentElement.remove()">繼續遊戲</button>
      `;
      
      overlay.appendChild(messageDiv);
      document.body.appendChild(overlay);
    }

    // 開新局
    function newGame() {
      statusEl.textContent = '請翻開兩張卡牌進行配對';
      matchedCount = 0;
      firstCard = null; 
      secondCard = null; 
      lockBoard = false;

      // 獲取選擇的難度
      totalPairs = parseInt(pairCountSelect.value);
      totalPairsEl.textContent = totalPairs;
      pairsEl.textContent = '0';

      // 選取名句
      selectedQuotes = pickRandomQuotes(totalPairs);

      // 初始化答案欄
      initAnswerBoard();

      // 建立卡牌
      cards = [];
      selectedQuotes.forEach((item) => {
        cards.push({ id: item.id, type: 'text', value: item.text });
        cards.push({ id: item.id, type: 'source', value: item.source });
      });
      shuffle(cards);

      // 渲染
      boardEl.innerHTML = '';
      cards.forEach((card, i) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.dataset.idx = i;
        div.dataset.id = card.id;
        div.dataset.type = card.type;
        
        // 卡片正面 - 顯示"翻牌"
        const cardFront = document.createElement('div');
        cardFront.className = 'card-front';
        cardFront.innerText = '翻牌';
        
        // 卡片背面 - 顯示內容
        const cardBack = document.createElement('div');
        cardBack.className = 'card-back';
        cardBack.innerText = card.value;
        
        div.appendChild(cardFront);
        div.appendChild(cardBack);
        div.addEventListener('click', () => flipCard(div, card, i));
        boardEl.appendChild(div);
      });

      // 根據難度調整網格
      if (totalPairs <= 5) {
        boardEl.style.gridTemplateColumns = 'repeat(5, 1fr)';
      } else if (totalPairs <= 8) {
        boardEl.style.gridTemplateColumns = 'repeat(4, 1fr)';
      } else {
        boardEl.style.gridTemplateColumns = 'repeat(5, 1fr)';
      }

      // 重置計時器
      resetTimer();
    }

    // 翻牌
    function flipCard(div, card, idx) {
      if (lockBoard || isPaused || div.classList.contains('matched')) return;
      if (div.classList.contains('flipped')) return;

      // 第一次翻牌才開啟計時
      if (!gameStarted) {
        gameStarted = true;
        startTimer();
      }

      div.classList.add('flipped');

      if (!firstCard) {
        firstCard = { div, card, idx };
      } else {
        secondCard = { div, card, idx };
        lockBoard = true;

        // 檢查配對
        if (
          firstCard.card.id === secondCard.card.id &&
          firstCard.card.type !== secondCard.card.type
        ) {
          // 配對成功
          setTimeout(() => {
            firstCard.div.classList.add('matched');
            secondCard.div.classList.add('matched');
            
            // 從遊戲板上移除配對成功的卡片
            setTimeout(() => {
              firstCard.div.style.visibility = 'hidden';
              secondCard.div.style.visibility = 'hidden';
            }, 500);
            
            // 更新答案欄
            const quote = selectedQuotes.find(q => q.id === firstCard.card.id);
            if (quote) {
              updateAnswerBoard(quote.id, quote.text, quote.source);
            }
            
            matchedCount++;
            pairsEl.textContent = matchedCount;
            resetTurn();

            if (matchedCount === totalPairs) {
              pauseTimer();
              statusEl.textContent = `恭喜你全部配對成功！用時：${formatTime(elapsed)}`;
              saveBestIfBetter(elapsed);
              setTimeout(showCompletionMessage, 500);
            }
          }, 500);
        } else {
          // 配對失敗
          setTimeout(() => {
            firstCard.div.classList.remove('flipped');
            secondCard.div.classList.remove('flipped');
            resetTurn();
          }, 1000);
        }
      }
    }

    function resetTurn() {
      [firstCard, secondCard] = [null, null];
      lockBoard = false;
    }

    // 按鈕事件
    btnNew.addEventListener('click', newGame);
    btnPause.addEventListener('click', () => {
      pauseTimer();
      isPaused = true;
      btnPause.style.display = 'none';
      btnResume.style.display = '';
      statusEl.textContent = '已暫停。點選「繼續」繼續遊戲。';
    });
    btnResume.addEventListener('click', () => {
      resumeTimer();
      isPaused = false;
      btnPause.style.display = '';
      btnResume.style.display = 'none';
      statusEl.textContent = '請翻開兩張卡牌進行配對';
    });
    
    // 主頁按鈕事件
    btnHome.addEventListener('click', () => {
      window.location.href = "https://wongonkei825-alt.github.io/MBC/1-400_home_page.html";
    });
    
    // 難度選擇事件
    pairCountSelect.addEventListener('change', newGame);

    // 初始化
    loadBest();
    newGame();
  </script>
</body>
</html>
