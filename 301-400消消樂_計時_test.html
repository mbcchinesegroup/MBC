<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>301-400名句配對消消樂遊戲</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", Arial, sans-serif;
      background: linear-gradient(135deg, #f4f8fb 0%, #e0eaf8 100%);
      margin: 0; padding: 0;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
    }
    h1 { 
      margin: 20px 0 6px; 
      color: #1976d2;
      text-align: center;
      font-size: 1.8rem;
    }
    .container {
      width: 95%;
      max-width: 1200px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .topbar {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      gap: 8px 12px;
      margin: 6px 12px 10px;
      font-size: 14px;
      width: 100%;
    }
    .stat {
      background: #fff;
      border-radius: 8px;
      padding: 6px 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      min-width: 90px;
      text-align: center;
      border-left: 4px solid #1976d2;
      font-size: 14px;
    }
    #status { 
      margin: 6px 0 10px; 
      font-size: 16px; 
      font-weight: bold;
      color: #333;
      text-align: center;
      padding: 8px 16px;
      background: rgba(255,255,255,0.7);
      border-radius: 20px;
    }
    .game-container {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #game-board {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      max-width: 1000px;
      width: 100%;
      margin: 10px auto 20px;
    }
    .card {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: #fff;
      border-radius: 8px;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      user-select: none;
      padding: 8px;
      text-align: center;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
    }
    .card:active { transform: scale(0.98); }
    .card.flipped {
      background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
      color: #222;
      cursor: default;
    }
    .card.matched {
      background: linear-gradient(135deg, #a5d6a7 0%, #66bb6a 100%);
      color: #2e7d32;
      cursor: default;
      box-shadow: 0 0 15px rgba(76, 175, 80, 0.4);
    }
    .card.mismatched {
      background: linear-gradient(135deg, #ffcdd2 0%, #ef9a9a 100%);
      color: #c62828;
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      backface-visibility: hidden;
      transition: transform 0.6s;
      border-radius: 8px;
      padding: 8px;
      box-sizing: border-box;
    }
    .card-front {
      background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
      color: white;
      font-weight: bold;
    }
    .card-back {
      background: white;
      color: #222;
      transform: rotateY(180deg);
      justify-content: center;
      font-size: 13px;
      overflow: auto;
    }
    .card.flipped .card-front {
      transform: rotateY(180deg);
    }
    .card.flipped .card-back {
      transform: rotateY(0deg);
    }
    button {
      margin: 6px 0 4px;
      padding: 10px 16px;
      font-size: 14px;
      border: none;
      background: #1976d2;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    button:hover {
      background: #1565c0;
      transform: translateY(-2px);
    }
    button:active { transform: translateY(1px); }
    .controls {
      display: flex; 
      gap: 8px; 
      flex-wrap: wrap; 
      justify-content: center;
      margin-bottom: 6px;
      width: 100%;
    }
    .settings {
      display: flex;
      gap: 8px;
      margin: 10px 0;
      flex-wrap: wrap;
      justify-content: center;
    }
    .setting-item {
      display: flex;
      align-items: center;
      gap: 5px;
      background: white;
      padding: 6px 10px;
      border-radius: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      font-size: 14px;
    }
    .note { 
      font-size: 12px; 
      color: #555; 
      margin-top: 4px; 
      text-align: center;
      max-width: 600px;
      padding: 0 10px;
    }
    .completed-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      padding: 20px 25px;
      border-radius: 12px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.2);
      text-align: center;
      z-index: 100;
      animation: popIn 0.5s ease;
      width: 80%;
      max-width: 300px;
    }
    
    /* 答案欄樣式 */
    #answer-board {
      width: 100%;
      max-width: 1000px;
      margin: 15px 0;
      padding: 12px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    #answer-board h2 {
      text-align: center;
      color: #1976d2;
      margin-top: 0;
      padding-bottom: 8px;
      border-bottom: 2px solid #1976d2;
      font-size: 1.3rem;
    }
    .answer-pair {
      display: flex;
      margin-bottom: 12px;
      border-bottom: 1px dashed #ccc;
      padding-bottom: 12px;
      align-items: center;
      min-height: 70px;
    }
    .answer-pair:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    .pair-number {
      width: 25px;
      height: 25px;
      background: #1976d2;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 8px;
      flex-shrink: 0;
      opacity: 0;
      transition: opacity 0.5s ease;
      font-size: 12px;
    }
    .pair-number.visible {
      opacity: 1;
    }
    .answer-text, .answer-source {
      flex: 1;
      padding: 8px;
      background: #f9f9f9;
      border-radius: 6px;
      margin: 0 4px;
      min-height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
      position: relative;
      font-size: 13px;
    }
    .answer-text {
      border-left: 4px solid #4caf50;
    }
    .answer-source {
      border-left: 4px solid #2196f3;
    }
    .answer-type {
      position: absolute;
      top: 3px;
      left: 8px;
      font-size: 10px;
      color: #888;
    }
    .answer-placeholder {
      color: #999;
      font-style: italic;
      font-size: 12px;
    }
    
    @keyframes popIn {
      0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    }
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 99;
    }
    
    /* 手機版專用樣式 */
    .mobile-controls {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
      z-index: 10;
      justify-content: space-around;
    }
    
    .mobile-btn {
      padding: 12px 16px;
      font-size: 14px;
      border: none;
      background: #1976d2;
      color: #fff;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    /* 響應式設計 */
    @media (max-width: 1000px) {
      #game-board { grid-template-columns: repeat(4, 1fr); }
    }
    @media (max-width: 800px) {
      #game-board { grid-template-columns: repeat(3, 1fr); }
      .card { height: 90px; font-size: 13px; }
      .answer-pair { flex-direction: column; }
      .answer-text, .answer-source { margin: 5px 0; width: 100%; }
      .pair-number { margin: 0 0 5px 0; }
    }
    @media (max-width: 600px) {
      h1 { font-size: 1.5rem; margin: 15px 0 5px; }
      .topbar { gap: 6px 8px; }
      .stat { 
        min-width: 70px; 
        font-size: 12px; 
        padding: 5px 8px;
      }
      #status { font-size: 14px; padding: 6px 12px; }
      #game-board { 
        grid-template-columns: repeat(2, 1fr); 
        gap: 8px;
      }
      .card { 
        height: 80px; 
        font-size: 12px; 
        border-radius: 6px;
      }
      .card-back { font-size: 11px; }
      .controls { gap: 6px; }
      button { 
        padding: 8px 12px; 
        font-size: 13px;
      }
      .setting-item { font-size: 12px; }
      .note { font-size: 11px; }
      
      /* 顯示手機底部控制欄 */
      .mobile-controls {
        display: flex;
      }
      
      /* 隱藏桌面版控制按鈕 */
      .controls {
        display: none;
      }
      
      /* 調整答案欄樣式 */
      #answer-board {
        margin-bottom: 70px; /* 為底部控制欄留出空間 */
        padding: 10px;
      }
      #answer-board h2 { font-size: 1.2rem; }
      .answer-text, .answer-source { 
        font-size: 12px; 
        padding: 6px;
      }
    }
    @media (max-width: 400px) {
      #game-board { grid-template-columns: repeat(2, 1fr); }
      .card { 
        height: 70px; 
        font-size: 11px; 
        padding: 5px;
      }
      .card-back { font-size: 10px; }
      .stat { min-width: 60px; font-size: 11px; }
      h1 { font-size: 1.3rem; }
      .mobile-btn { padding: 10px 12px; font-size: 12px; }
    }
    @media (max-width: 350px) {
      .card { height: 65px; }
      #game-board { gap: 6px; }
    }

    .btn { 
      margin: 6px 0 4px;
      padding: 10px 16px;
      font-size: 14px;
      border: none;
      background: #1976d2;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
    }
    
    /* 防止手機上文字選中 */
    .no-select {
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
  </style>
</head>
<body class="no-select">
  <div class="container">
    <div style="text-align: center; margin: 15px 0; width: 100%;">
 </div>
<h1>中文組</h1>
    <h1>301-400名句配對消消樂</h1>
    <div class="topbar">
      <div class="stat">計時：<span id="timer">00:00.0</span></div>
      <div class="stat">配對：<span id="pairs">0</span>/<span id="total-pairs">0</span></div>
      <div class="stat">最佳：<span id="best">—</span></div>
    </div>

    <div id="status">請翻開兩張卡牌進行配對</div>

    <div class="settings">
      <div class="setting-item">
        <label for="pair-count">遊戲難度:</label>
        <select id="pair-count">
          <option value="5">簡單 (5組)</option>
          <option value="8">中等 (8組)</option>
          <option value="10">困難 (10組)</option>
        </select>
      </div>
    </div>

    <div class="controls">
      <button id="btn-home" class="btn">主頁</button>
      <button id="btn-new" class="btn">重新開始</button>
      <button id="btn-pause" class="btn">暫停</button>
      <button id="btn-resume" class="btn" style="display:none;">繼續</button>
    </div>
    <div class="note">提示：翻牌開始即計時，全部配對完成自動停止。配對成功時卡片會移動到下方答案欄。</div>

    <div class="game-container">
      <div id="game-board"></div>
    </div>
    
    <!-- 答案欄 -->
    <div id="answer-board">
      <h2>答案欄</h2>
      <div id="answer-container"></div>
    </div>
  </div>
  
  <!-- 手機版底部控制欄 -->
  <div class="mobile-controls">
    <button id="mobile-home" class="mobile-btn">主頁</button>
    <button id="mobile-new" class="mobile-btn">重新開始</button>
    <button id="mobile-pause" class="mobile-btn">暫停</button>
    <button id="mobile-resume" class="mobile-btn" style="display:none;">繼續</button>
  </div>


  <script>
    // 完整的名句列表（帶有序號）
    const quotes = [
    
{"id": 301, "text": "不是花中偏愛菊，此花開盡更無花。", "source": "元稹《菊花》"},
{ "id": 302, "text": "春種一粒粟，秋收萬顆子。", "source": "李紳《憫農》" },
{ "id": 303, "text": "姑蘇城外寒山寺，夜半鐘聲到客船。", "source": "張繼《楓橋夜泊》" },
{ "id": 304, "text": "柴門聞犬吠，風雪夜歸人。", "source": "劉長卿《逢雪宿芙蓉山主人》" },
{ "id": 305, "text": "勸君莫惜金縷衣，勸君惜取少年時。花開堪折直須折，莫待無花空折枝。", "source": "杜秋娘《金縷衣》" },
{ "id": 306, "text": "溪雲初起日沉閣，山雨欲來風滿樓。", "source": "許渾《咸陽城東樓》" },
{ "id": 307, "text": "西塞山前白鷺飛，桃花流水鱖魚肥。", "source": "張志和《漁歌子》" },
{ "id": 308, "text": "別時容易見時難。流水落花春去也，天上人間。", "source": "李煜《浪淘沙》" },
{ "id": 309, "text": "先天下之憂而憂，後天下之樂而樂。", "source": "范仲淹《岳陽樓記》" },
{ "id": 310, "text": "醉翁之意不在酒，在乎山水之間也。", "source": "歐陽修《醉翁亭記》" },
{ "id": 311, "text": "憂勞可以興國，逸豫可以亡身。", "source": "歐陽修《五代史伶官傳序》" },
{ "id": 312, "text": "衣帶漸寬終不悔，為伊消得人憔悴。", "source": "柳永《風栖梧》" },
{ "id": 313, "text": "多情自古傷離別。更那堪，冷落清秋節。", "source": "柳永《雨霖鈴》" },
{ "id": 314, "text": "今宵酒醒何處，楊柳岸、曉風殘月。", "source": "柳永《雨霖鈴》" },
{ "id": 315, "text": "鑒前世之興衰，考當今之得失。", "source": "司馬光《資治通鑒》" },
{ "id": 316, "text": "兼聽則明，偏信（聽）則暗。", "source": "司馬光《資治通鑒》" },
{ "id": 317, "text": "由儉入奢易，由奢入儉難。", "source": "司馬光《訓儉示康》" },
{ "id": 318, "text": "春風又綠江南岸，明月何時照我還？", "source": "王安石《泊船瓜州》" },
{ "id": 319, "text": "不畏浮雲遮望眼，只緣身在最高層。", "source": "王安石《登飛來峰》" },
{ "id": 320, "text": "千門萬戶曈曈日，總把新桃換舊符。", "source": "王安石《元日》" },
{ "id": 321, "text": "荷盡已無擎雨蓋，菊殘猶有傲霜枝。", "source": "蘇軾《贈劉景文》" },
{ "id": 322, "text": "大勇若怯，大智若愚。", "source": "蘇軾《賀歐陽少師致仕啟》" },
{ "id": 323, "text": "大江東去，浪淘盡、千古風流人物。", "source": "蘇軾《念奴嬌・赤壁懷古》" },
{ "id": 324, "text": "江山如畫，一時多少豪傑。", "source": "蘇軾《念奴嬌・赤壁懷古》" },
{ "id": 325, "text": "枝上柳綿吹又少，天涯何處無芳草。", "source": "蘇軾《蝶戀花・春景》" },
{ "id": 326, "text": "欲把西湖比西子，淡妝濃抹兩相宜。", "source": "蘇軾《飲湖上初晴後雨》" },
{ "id": 327, "text": "人有悲歡離合，月有陰晴圓缺。", "source": "蘇軾《水調歌頭》" },
{ "id": 328, "text": "但願人長久，千里共嬋娟。", "source": "蘇軾《水調歌頭》" },
{ "id": 329, "text": "不識廬山真面目，只緣身在此山中。", "source": "蘇軾《題西林壁》" },
{ "id": 330, "text": "竹外桃花三兩枝，春江水暖鴨先知。", "source": "蘇軾《惠崇春江晚景》" },
{ "id": 331, "text": "月出於東山之上，徘徊於斗牛之間。", "source": "蘇軾《前赤壁賦》" },
{ "id": 332, "text": "園囿之興廢，洛陽盛衰之候也。", "source": "李格飛《書〈洛陽名園記〉後》" },
{ "id": 333, "text": "一春魚雁無消息，千里關山勞夢魂。", "source": "秦觀《鷓鴣天・春閨》" },
{ "id": 334, "text": "兩情若是久長時，又豈在朝朝暮暮。", "source": "秦觀《鵲橋仙》" },
{ "id": 335, "text": "出淤泥而不染，濯清漣而不妖。", "source": "周敦頤《愛蓮說》" },
{ "id": 336, "text": "莫道不銷魂，簾捲西風，人比黃花瘦。", "source": "李清照《醉花陰》" },
{ "id": 337, "text": "只恐雙溪舴艋舟，載不動許多愁。", "source": "李清照《武陵春》" },
{ "id": 338, "text": "花自飄零水自流，一種相思，兩處閑愁。此情無計可清除，才下眉頭，卻上心頭。", "source": "李清照《一剪梅》" },
{ "id": 339, "text": "尋尋覓覓，冷冷清清，淒淒慘慘戚戚。", "source": "李清照《聲聲慢》" },
{ "id": 340, "text": "生當作人傑，死亦為鬼雄。", "source": "李清照《夏日絕句》" },
{ "id": 341, "text": "無意苦爭春，一任群芳妒。", "source": "陸遊《卜算子・詠梅》" },
{ "id": 342, "text": "僵卧孤村不自哀，尚思為國戍輪台。夜闌臥聽風吹雨，鐵馬冰河入夢來。", "source": "陸遊《十一月四日風雨大作》" },
{ "id": 343, "text": "紙上得來終覺淺，絶知此事要躬行。", "source": "陸遊《冬夜讀書示子聿》" },
{ "id": 344, "text": "文章本天成，妙手偶得之。", "source": "陸遊《文章》" },
{ "id": 345, "text": "山重水複疑無路，柳暗花明又一村。", "source": "陸遊《遊山西村》" },
{ "id": 346, "text": "出師一表真名世，千載誰堪伯仲間！", "source": "陸遊《書憤》" },
{ "id": 347, "text": "疏影橫斜水清淺，暗香浮動月黃昏。", "source": "林逋《山園小梅》" },
{ "id": 348, "text": "小荷才露尖尖角，早有蜻蜓立上頭。", "source": "楊萬里《小池》" },
{ "id": 349, "text": "畢竟西湖六月中，風光不與四時同。", "source": "楊萬里《曉出凈慈寺送林子方》" },
{ "id": 350, "text": "接天蓮葉無窮碧，映日荷花別樣紅。", "source": "楊萬里《曉出凈慈寺送林子方》" },
{ "id": 351, "text": "月子彎彎照九州，幾家歡樂幾家愁。", "source": "楊萬里《竹枝歌》" },
{ "id": 352, "text": "春花秋月冬冰雪，不聽陳言只聽天。", "source": "楊萬里《讀張文潛詩》" },
{ "id": 353, "text": "稻花香里說豐年，聽取蛙聲一片。", "source": "辛棄疾《西江月・夜行黃沙道中》" },
{ "id": 354, "text": "楚天千里清秋，水隨天去秋無際。", "source": "辛棄疾《水龍吟・登建康賞心亭》" },
{ "id": 355, "text": "眾里尋他千百度。驀然回首，那人卻在、燈火闌珊處。", "source": "辛棄疾《青玉案・元夕》" },
{ "id": 356, "text": "青山遮不住，畢竟東流去。", "source": "辛棄疾《菩薩蠻・書江西造口壁》" },
{ "id": 357, "text": "二十四橋仍在，波心蕩、冷月無聲。", "source": "姜夔《揚州慢》" },
{ "id": 358, "text": "一語天然萬古新，豪華落盡見真淳。", "source": "元好問《論詩三十首》" },
{ "id": 359, "text": "林間新綠一重重，小蕾深藏數點紅。", "source": "元好問《同兒輩賦未開海棠》" },
{ "id": 360, "text": "臣心一片磁針石，不指南方不肯休。", "source": "文天祥《揚子江》" },
{ "id": 361, "text": "山河破碎風飄絮，身世浮沉雨打萍。", "source": "文天祥《過零丁洋》" },
{ "id": 362, "text": "人生自古誰無死，留取丹心照汗青。", "source": "文天祥《過零丁洋》" },
{ "id": 363, "text": "無可奈何花落去，似曾相識燕歸來。", "source": "晏殊《浣溪沙》" },
{ "id": 364, "text": "春色滿園關不住，一枝紅杏出牆來。", "source": "葉紹翁《游園不值》" },
{ "id": 365, "text": "即以其人之道，還治其人之身。", "source": "朱熹《中庸集註・十三章》" },
{ "id": 366, "text": "等閒識得東風面，萬紫千紅總是春。", "source": "朱熹《春日》" },
{ "id": 367, "text": "問渠那得清如許？為有源頭活水來。", "source": "朱熹《觀書有感》" },
{ "id": 368, "text": "讀書千遍，其義自見。", "source": "朱熹《熟讀精思》" },
{ "id": 369, "text": "三十功名塵與土，八千里路雲和月。", "source": "岳飛《滿江紅》" },
{ "id": 370, "text": "不要人誇顏色好，只留清氣滿乾坤。", "source": "王冕《墨梅》" },
{ "id": 371, "text": "著意栽花花不發，無意插柳柳成蔭。", "source": "關漢卿《包待制智斬魯齋郎》" },
{ "id": 372, "text": "成也蕭何，敗也蕭何，醉了由他。", "source": "馬致遠《雙調・蟾宮曲・嘆世》" },
{ "id": 373, "text": "碧雲天，黃花地，西風緊，北雁南飛。曉來誰染霜林醉？總是離人淚。", "source": "王實甫《西厢記》" },
{ "id": 374, "text": "一言既出，駟馬難追。", "source": "李壽卿《伍員吹簫》" },
{ "id": 375, "text": "不是一番寒徹骨，怎得梅花撲鼻香。", "source": "高明《琵琶記》" },
{ "id": 376, "text": "十年窗下無人問，一舉成名天下知。", "source": "高明《琵琶記》" },
{ "id": 377, "text": "良辰美景奈何天，賞心樂事誰家院？", "source": "湯顯祖《牡丹亭》" },
{ "id": 378, "text": "金玉其外，敗絮其中。", "source": "劉基《賣柑者言》" },
{ "id": 379, "text": "人逢喜事精神爽，月到中秋分外明。", "source": "馮夢龍《古今小說》" },
{ "id": 380, "text": "觀棋不語真君子，把酒多言是小人。", "source": "馮夢龍《醒世恆言》" },
{ "id": 381, "text": "留得青山在，不怕沒柴燒。", "source": "凌濛初《初刻拍案驚奇》" },
{ "id": 382, "text": "謀事在人，成事在天。", "source": "羅貫中《三國演義》" },
{ "id": 383, "text": "周郎妙計安天下，賠了夫人又折兵。", "source": "羅貫中《三國演義》" },
{ "id": 384, "text": "明日復明日，明日何其多。我生待明日，萬事成蹉跎。", "source": "錢福《明日歌》" },
{ "id": 385, "text": "粉身碎骨渾不怕，要留清白在人間。", "source": "于謙《石灰吟》" },
{ "id": 386, "text": "但願蒼生俱飽暖，不辭辛苦出山林。", "source": "于謙《詠煤炭》"},
{ "id": 387, "text": "世事洞明皆學問，人情練達即文章。", "source": "曹雪芹《紅樓夢》" },
{ "id": 388, "text": "友如作畫須求淡，山似論文不喜平。", "source": "翁照《尚湖晚步》" },
{ "id": 389, "text": "千磨萬擊還堅勁，任爾東西南北風。", "source": "鄭燮《竹石》" },
{ "id": 390, "text": "海納百川，有容乃大；壁立千仞，無欲則剛。", "source": "林則徐・對聯" },
{ "id": 391, "text": "天下興亡，匹夫有責。", "source": "顧炎武《日知錄》" },
{ "id": 392, "text": "落紅不是無情物，化作春泥更護花。", "source": "龔自珍《己亥雜詩》" },
{ "id": 393, "text": "九州生氣恃風雷，萬馬齊喑究可哀。", "source": "龔自珍《己亥雜詩》" },
{ "id": 394, "text": "我勸天公重抖擻，不拘一格降人才。", "source": "龔自珍《己亥雜詩》" },
{ "id": 395, "text": "我自橫刀向天笑，去留肝膽兩崑崙。", "source": "譚嗣同《獄中題壁》" },
{ "id": 396, "text": "江山代有才人出，各領風騷數百年。", "source": "趙翼《論詩五首》" },
{ "id": 397, "text": "橫眉冷對千夫指，俯首甘為孺子牛。", "source": "魯迅《自嘲》" },
{ "id": 398, "text": "寄意寒星荃不察，我以我血薦軒轅。", "source": "魯迅《自題小像》" },
{ "id": 399, "text": "俏也不爭春，只把春來報。待到山花爛漫時，她在叢中笑。", "source": "毛澤東《卜算子・詠梅》" },
{ "id": 400, "text": "天若有情天亦老，人間正道是滄桑。", "source": "毛澤東《七律・人民解放軍占領南京》" }
     ];

    // 遊戲狀態
    let cards = [];
    let firstCard = null, secondCard = null;
    let lockBoard = false;
    let matchedCount = 0;
    let totalPairs = 5; // 預設5組
    let selectedQuotes = []; // 當前選中的名句

    // 計時器狀態
    let timerInterval = null;
    let startTime = 0;
    let elapsed = 0;
    let running = false;
    let gameStarted = false;
    let isPaused = false;

    const boardEl = document.getElementById('game-board');
    const statusEl = document.getElementById('status');
    const timerEl = document.getElementById('timer');
    const bestEl = document.getElementById('best');
    const pairsEl = document.getElementById('pairs');
    const totalPairsEl = document.getElementById('total-pairs');
    const btnNew = document.getElementById('btn-new');
    const btnPause = document.getElementById('btn-pause');
    const btnResume = document.getElementById('btn-resume');
    const btnHome = document.getElementById('btn-home');
    const pairCountSelect = document.getElementById('pair-count');
    const answerContainerEl = document.getElementById('answer-container');
    
    // 手機版按鈕
    const mobileNew = document.getElementById('mobile-new');
    const mobilePause = document.getElementById('mobile-pause');
    const mobileResume = document.getElementById('mobile-resume');
    const mobileHome = document.getElementById('mobile-home');

    // 工具：洗牌
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // 取隨機名句組
    function pickRandomQuotes(num) {
      // 確保不超過可用名句數量
      const availableQuotes = [...quotes];
      if (num > availableQuotes.length) {
        num = availableQuotes.length;
      }
      
      const indices = shuffle([...Array(availableQuotes.length).keys()]);
      return indices.slice(0, num).map(i => availableQuotes[i]);
    }

    // 初始化答案欄
    function initAnswerBoard() {
      answerContainerEl.innerHTML = '';
      selectedQuotes.forEach((quote) => {
        const pairDiv = document.createElement('div');
        pairDiv.className = 'answer-pair';
        pairDiv.id = `answer-pair-${quote.id}`;
        
        // 添加序號（初始隱藏）
        const numberDiv = document.createElement('div');
        numberDiv.className = 'pair-number';
        numberDiv.textContent = quote.id;
        numberDiv.style.display = 'none'; // 初始隱藏
        
        const textDiv = document.createElement('div');
        textDiv.className = 'answer-text';
        textDiv.innerHTML = '<span class="answer-placeholder">等待配對...</span>';
        const textType = document.createElement('div');
        textType.className = 'answer-type';
        textType.textContent = '名句';
        textDiv.appendChild(textType);
        
        const sourceDiv = document.createElement('div');
        sourceDiv.className = 'answer-source';
        sourceDiv.innerHTML = '<span class="answer-placeholder">等待配對...</span>';
        const sourceType = document.createElement('div');
        sourceType.className = 'answer-type';
        sourceType.textContent = '出處';
        sourceDiv.appendChild(sourceType);
        
        pairDiv.appendChild(numberDiv);
        pairDiv.appendChild(textDiv);
        pairDiv.appendChild(sourceDiv);
        answerContainerEl.appendChild(pairDiv);
      });
    }

    // 更新答案欄
    function updateAnswerBoard(quoteId, text, source) {
      const pairDiv = document.getElementById(`answer-pair-${quoteId}`);
      if (pairDiv) {
        // 顯示序號
        const numberDiv = pairDiv.querySelector('.pair-number');
        numberDiv.style.display = 'flex';
        setTimeout(() => {
          numberDiv.classList.add('visible');
        }, 10);
        
        const textDiv = pairDiv.querySelector('.answer-text');
        const sourceDiv = pairDiv.querySelector('.answer-source');
        
        textDiv.innerHTML = text;
        const textType = document.createElement('div');
        textType.className = 'answer-type';
        textType.textContent = '名句';
        textDiv.appendChild(textType);
        
        sourceDiv.innerHTML = source;
        const sourceType = document.createElement('div');
        sourceType.className = 'answer-type';
        sourceType.textContent = '出處';
        sourceDiv.appendChild(sourceType);
        
        // 添加動畫效果
        textDiv.style.animation = 'none';
        sourceDiv.style.animation = 'none';
        setTimeout(() => {
          textDiv.style.animation = 'popIn 0.5s ease';
          sourceDiv.style.animation = 'popIn 0.5s ease';
        }, 10);
      }
    }

    // 計時器：格式化
    function formatTime(ms) {
      const totalMs = Math.max(0, ms | 0);
      const totalSec = Math.floor(totalMs / 1000);
      const min = Math.floor(totalSec / 60);
      const sec = totalSec % 60;
      const deci = Math.floor((totalMs % 1000) / 100);
      const mm = String(min).padStart(2, '0');
      const ss = String(sec).padStart(2, '0');
      return `${mm}:${ss}.${deci}`;
    }

    // 計時器：更新畫面
    function updateTimerDisplay() {
      timerEl.textContent = formatTime(elapsed);
    }

    // 計時器：開始
    function startTimer() {
      if (running) return;
      running = true;
      gameStarted = true; // 確保遊戲狀態標記為已開始
      startTime = performance.now();
      timerInterval = setInterval(() => {
        const now = performance.now();
        elapsed += (now - startTime);
        startTime = now;
        updateTimerDisplay();
      }, 100);
    }

    // 計時器：暫停
    function pauseTimer() {
      if (!running) return;
      running = false;
      clearInterval(timerInterval);
      timerInterval = null;
    }

    // 計時器：恢復
    function resumeTimer() {
      if (running) return;
      running = true;
      startTime = performance.now();
      timerInterval = setInterval(() => {
        const now = performance.now();
        elapsed += (now - startTime);
        startTime = now;
        updateTimerDisplay();
      }, 100);
    }

    // 計時器：重置
    function resetTimer() {
      pauseTimer();
      elapsed = 0;
      running = false;
      gameStarted = false;
      updateTimerDisplay();
      btnPause.style.display = '';
      btnResume.style.display = 'none';
      mobilePause.style.display = '';
      mobileResume.style.display = 'none';
      isPaused = false;
    }

    // 最佳成績
    const BEST_KEY = 'match-quote-best-time-ms';
    function loadBest() {
      const v = localStorage.getItem(BEST_KEY);
      if (v && !isNaN(+v)) {
        bestEl.textContent = formatTime(+v);
      } else {
        bestEl.textContent = '—';
      }
    }
    
    function saveBestIfBetter(ms) {
      const v = localStorage.getItem(BEST_KEY);
      if (!v || ms < +v) {
        localStorage.setItem(BEST_KEY, String(ms));
        bestEl.textContent = formatTime(ms);
      }
    }

    // 顯示完成訊息
    function showCompletionMessage() {
      const overlay = document.createElement('div');
      overlay.className = 'overlay';
      
      const messageDiv = document.createElement('div');
      messageDiv.className = 'completed-message';
      messageDiv.innerHTML = `
        <h2>恭喜完成！</h2>
        <p>您用時: ${formatTime(elapsed)}</p>
        <p>${elapsed < 60000 ? '🎉 太棒了！' : '👍 做得很好！'}</p>
        <button class="btn" onclick="this.parentElement.parentElement.remove()">繼續遊戲</button>
      `;
      
      overlay.appendChild(messageDiv);
      document.body.appendChild(overlay);
    }

    // 開新局
    function newGame() {
      statusEl.textContent = '請翻開兩張卡牌進行配對';
      matchedCount = 0;
      firstCard = null; 
      secondCard = null; 
      lockBoard = false;

      // 獲取選擇的難度
      totalPairs = parseInt(pairCountSelect.value);
      totalPairsEl.textContent = totalPairs;
      pairsEl.textContent = '0';

      // 選取名句
      selectedQuotes = pickRandomQuotes(totalPairs);

      // 初始化答案欄
      initAnswerBoard();

      // 建立卡牌
      cards = [];
      selectedQuotes.forEach((item) => {
        cards.push({ id: item.id, type: 'text', value: item.text });
        cards.push({ id: item.id, type: 'source', value: item.source });
      });
      shuffle(cards);

      // 渲染
      boardEl.innerHTML = '';
      cards.forEach((card, i) => {
        const div = document.createElement('div');
        div.className = 'card';
        div.dataset.idx = i;
        div.dataset.id = card.id;
        div.dataset.type = card.type;
        
        // 卡片正面 - 顯示"翻牌"
        const cardFront = document.createElement('div');
        cardFront.className = 'card-front';
        cardFront.innerText = '翻牌';
        
        // 卡片背面 - 顯示內容
        const cardBack = document.createElement('div');
        cardBack.className = 'card-back';
        cardBack.innerText = card.value;
        
        div.appendChild(cardFront);
        div.appendChild(cardBack);
        
        // 使用事件委派而不是直接綁定事件
        boardEl.appendChild(div);
      });

      // 根據難度調整網格
      if (totalPairs <= 5) {
        boardEl.style.gridTemplateColumns = 'repeat(5, 1fr)';
      } else if (totalPairs <= 8) {
        boardEl.style.gridTemplateColumns = 'repeat(4, 1fr)';
      } else {
        boardEl.style.gridTemplateColumns = 'repeat(5, 1fr)';
      }

      // 重置計時器
      resetTimer();
      
      // 重新綁定卡片點擊事件
      bindCardEvents();
    }

    // 綁定卡片事件
    function bindCardEvents() {
      const cardElements = boardEl.querySelectorAll('.card');
      cardElements.forEach((div, i) => {
        const card = cards[i];
        // 移除舊的事件監聽器
        div.onclick = null;
        div.ontouchstart = null;
        
        // 添加新的事件監聽器
        div.addEventListener('click', () => flipCard(div, card, i));
        div.addEventListener('touchstart', (e) => {
          if (e.touches.length === 1) { // 確保是單指觸控
            e.preventDefault(); // 防止手機上的默認行為
            flipCard(div, card, i);
          }
        }, { passive: false });
      });
    }

    // 翻牌
    function flipCard(div, card, idx) {
      if (lockBoard || isPaused || div.classList.contains('matched')) return;
      if (div.classList.contains('flipped')) return;

      // 第一次翻牌才開啟計時
      if (!gameStarted) {
        startTimer(); // 直接啟動計時器
      }

      div.classList.add('flipped');

      if (!firstCard) {
        firstCard = { div, card, idx };
      } else {
        secondCard = { div, card, idx };
        lockBoard = true;

        // 檢查配對
        if (
          firstCard.card.id === secondCard.card.id &&
          firstCard.card.type !== secondCard.card.type
        ) {
          // 配對成功
          setTimeout(() => {
            firstCard.div.classList.add('matched');
            secondCard.div.classList.add('matched');
            
            // 從遊戲板上移除配對成功的卡片
            setTimeout(() => {
              firstCard.div.style.visibility = 'hidden';
              secondCard.div.style.visibility = 'hidden';
            }, 500);
            
            // 更新答案欄
            const quote = selectedQuotes.find(q => q.id === firstCard.card.id);
            if (quote) {
              updateAnswerBoard(quote.id, quote.text, quote.source);
            }
            
            matchedCount++;
            pairsEl.textContent = matchedCount;
            resetTurn();

            if (matchedCount === totalPairs) {
              pauseTimer();
              statusEl.textContent = `恭喜你全部配對成功！用時：${formatTime(elapsed)}`;
              saveBestIfBetter(elapsed);
              setTimeout(showCompletionMessage, 500);
            }
          }, 500);
        } else {
          // 配對失敗
          setTimeout(() => {
            firstCard.div.classList.remove('flipped');
            secondCard.div.classList.remove('flipped');
            resetTurn();
          }, 1000);
        }
      }
    }

    function resetTurn() {
      [firstCard, secondCard] = [null, null];
      lockBoard = false;
    }

    // 按鈕事件
    function setupButtonEvents() {
      // 桌面版按鈕
      btnNew.addEventListener('click', newGame);
      btnPause.addEventListener('click', pauseGame);
      btnResume.addEventListener('click', resumeGame);
      btnHome.addEventListener('click', goHome);
      
      // 手機版按鈕
      mobileNew.addEventListener('click', newGame);
      mobilePause.addEventListener('click', pauseGame);
      mobileResume.addEventListener('click', resumeGame);
      mobileHome.addEventListener('click', goHome);
    }
    
    function pauseGame() {
      pauseTimer();
      isPaused = true;
      btnPause.style.display = 'none';
      btnResume.style.display = '';
      mobilePause.style.display = 'none';
      mobileResume.style.display = '';
      statusEl.textContent = '已暫停。點選「繼續」繼續遊戲。';
    }
    
    function resumeGame() {
      resumeTimer();
      isPaused = false;
      btnPause.style.display = '';
      btnResume.style.display = 'none';
      mobilePause.style.display = '';
      mobileResume.style.display = 'none';
      statusEl.textContent = '請翻開兩張卡牌進行配對';
    }
    
    function goHome() {
      window.location.href = "https://wongonkei825-alt.github.io/MBC/1-400_home_page.html";
    }

    // 難度選擇事件
    pairCountSelect.addEventListener('change', newGame);

    // 初始化
    function init() {
      loadBest();
      setupButtonEvents();
      newGame();
    }

    // 啟動遊戲
    init();
  </script>
</body>
</html>
